[toc]



# CPU

## 构成

-   运算器：负责算术运算和逻辑运算
-   控制器：负责控制程序运行的流程
-   寄存器：负责暂存CPU处理过程中的信息（数据、地址以及指令信息），访问速度最快
-   高速缓存：有CPU中的MMU控制，访问速度比内存快，低于寄存器



## 寄存器



寄存器分为两类：

-   用户可见寄存器：对所有程序可用
    -   数据（通用）寄存器：用于各种算术逻辑指令和访存指令
    -   地址寄存器：存储数据以及指令的物理地址
    -   条件码寄存器：保存CPU操作结果的各种标记位
-   控制和状态寄存器：操作系统可用
    -   程序计数器：记录下一条要执行的指令的地址
    -   指令寄存器：记录最近取出的地址
    -   程序状态字：记录了CPU运行模式的信息



## 指令执行的基本过程



![image-20200525225743342](https://images-1255831004.cos.ap-guangzhou.myqcloud.com/online/image-20200525225743342.png)

>   程序的执行就是由不断获取指令、执行指令周期组成



指令的类型：

-   访问存储器指令：负责CPU和存储器之间的数据传送
-   I/O指令：负责CPU和I/O模块之间的数据传送和命令发送
-   算术逻辑指令（数据处理指令）：执行关于数据的算术和逻辑操作
-   控制转移指令：指定一个新指令的执行起点
-   CPU控制指令：用于修改处理机状态



## 特权指令和非特权指令

>   如果某微型计算机是处于多用户或多任务的多道程序设计环境中，则它的指令系统中的指令必须分成两部分：特权指令和非特权指令。



特权指令：只能由操作系统执行

非特权指令：用户和操作系统都能执行

>   如果用户使用特权指令，一半会引起一次CPU状态切换



## CPU状态

>   多数系统将CPU工作状态划分为管态和目态



管态，又称特权态，具备交高的权限级别，可以执行全部指令，使用全部资源

目态，又称用户态，具有较低的权限级别

>   不同系统划分的状态不一定相同，不是所有系统都是管态和目态，有些系统会划分多个系统状态



## 程序状态字

>   为了解决处理机当前工作状态的问题，所有的处理机都有一些特殊寄存器，用以表明处理机当前的工作状态。



状态字包括：

-   CPU的工作状态代码：指令CPU目前处于管态还是目态
-   条件码：反应执行后的结果特征
-   中断屏蔽码：是否允许中断



# 存储系统

## 存储器类型

半导体存储器基本可以划分为两类：

-   读写型存储器（随机访问存储器，RAM）
-   只读型存储器（ROM）：能读数据，不能随意写数据（写数据使用特殊方法）

>   在微型计算机中，通常把一些常驻内存的模块以微程序形式固化在ROM中



## 存储器的层次结构

计算机存储系统的设计主要考虑3个问题：容量、速度和成本。



一般来说，3个目标不可能同时达到最优，要作权衡。存取速度越快，每比特价格越高；容量越大，每比特价格越低，同时存取速度也越慢。



一方面需要较低的比特价格和较大的容量，另一方面对计算机性能又有着高要求，这又需要价格昂贵、存储量相对较小但速度很快的存储器。解决的方案是采用层次化的存储体系结构。



![image-20200527081739104](https://images-1255831004.cos.ap-guangzhou.myqcloud.com/online/image-20200527081739104.png)

>   越接近顶端越贵，访问速度越快；越靠近底部越便宜，访问速度越慢



层次化的存储体系结构可以提高存储系统的效能，**关键点在于程序的存储访问局部性原理**

>   在较短时间内，CPU要执行的指令集合能比较稳定第保持在一个存储器的局部区域中，CPU也主要喝存储器的这个局部打交道



## 存储分块

存储的最小单位称为“二进制位”，它包含的信息为0或1。



存储器的最小编址单位是字节，1个字节包含8个二进制位。而两个字节称为1个字，4个字节称为1个双字。1024个字节称为1KB，1024KB称为1MB，1024MB称为1GB，1024GB称为1TB。



为了简化对存储器的分配和管理，在不少计算机系统中把存储器分成块。在为用户分配内存空间时，以块为最小单位，这样的块有时被称为一个物理页。而块的大小随计算机而异，512B、1KB、4KB、8KB的都有，也有其他大小的。



## 存储保护

常见的存储保护机制：

-   界地址寄存器（界限寄存器）
    通过一对寄存器表示用户程序在内存中可以访问内存地址的上限和下线，如果越界访问，则产生越界中断
-   存储键
    每个存储块都附加一个存储保护键。当一个用户程序被允许进入内存时，操作系统分给它一个唯一的不与其他程序相同的存储键号。并将分配给该程序的各存储块的存储键也设置成同样的键号。当操作系统挑选该程序上处理机运行时，操作系统同时将它的存储键号放入程序状态字（PSW）的存储键（“钥匙”）域中。每当处理机访问内存时，都将该内存块的存储键与PSW中的“钥匙”进行比较。如果相匹配，则允许访问；否则，拒绝并报警。



## 缓冲技术

缓冲技术一般有三种用途：

-   CPU和内存之间
-   CPU和其他外围设备之间
-   设备和设备之间的通信

>   缓冲技术是为了解决部件之间速度不匹配的问题



为了提高设备利用率，通常使用单个缓冲区是不够的。目前许多计算机系统广泛使用多缓冲区技术



## 中断技术

所谓中断，是指处理机对系统中或系统外发生的异步事件的响应。异步事件是指无一定时序关系的随机发生的事件，如外围设备完成数据传输，实时控制设备出现异常情况等。



中断的出现解决了主机和外围设备并行工作的问题，消除了因外围设备的慢速而使得主机等待的现象，提高了可靠性，为多机操作和实时处理提供了硬件基础。



引起中断的那些事件称为中断事件或中断源，中断源向处理机发出的请求信号称为中断请求，而处理中断事件的那段程序称为中断处理程序。



发生中断时正在执行的程序的暂停点称为中断断点，处理机暂停当前程序转而处理中断的过程称为中断响应，中断处理结束之后恢复原来程序的执行称为中断返回。



中断的作用：

-   提高CPU的使用率
-   提高系统的实时能力



典型中断：

-   程序中断
-   时钟中断
-   I/O中断
-   硬件失效中断



中断系统组成：

-   中断装置（硬件）：负责捕获、响应中断源，将CPU的控制权移交给中断处理程序
-   中断处理程序（软件）：辨别中断类型，并根据请求做出相应的操作



# 进程

